<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microtonal Explorer Project</title>
    <!-- Add React and other dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2989ff;
            --secondary-color: #1e40af;
            --text-color: #1f2937;
            --bg-color: #ffffff;
            --section-bg: #f3f4f6;
        }
    
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
        }
    
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
    
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--section-bg);
            border-radius: 8px;
        }
    
        h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
    
        .project-section {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 2.5rem 3rem;
            /* Increased padding */
            margin-bottom: 2rem;
        }
    
        ol {
            padding-left: 2.5rem;
            /* More space for numbers */
            margin: 0.5rem 0;
        }
    
        ol>li {
            margin: 0.0rem 0 !important; /* This controls the space above and below each numbered */
            padding-left: 1rem;
            /* Space after the number */
        }
    
        h2 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
    
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
    
        .feature-card {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 1.5rem 0;
        }
    
        .instruction-item {
            margin: 1rem 0;
            padding: 0.5rem;
        }
    
        ul {
            margin: 1rem 0;
            padding-left: 2rem;
        }
    
        .demo-section img {
            max-width: 100%;
            border-radius: 6px;
            margin: 1rem 0;
        }
    
        code {
            background: #e5e7eb;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
        }
    
        .installation {
            background: #1f2937;
            color: #ffffff;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-family: monospace;
        }
    
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
    
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Microtonal Explorer Project</h1>
            <p>A Computer Application to Explore 53-Tone Equal Temperament Harmonies Through Modal Interchange</p>
        </header>

        <section class="project-section">
            <h2 class="text-2xl font-bold mb-4 text-blue-600">Project Overview</h2>
            <p>The Microtonal Explorer is a novel computer application that enables real-time exploration and
                manipulation of microtonal harmonies in 53-tone equal temperament (53-TET). Building upon traditional
                12-TET modes and incorporating principles from 31-TET, the application offers an intuitive interface
                with real-time visualization and MIDI Polyphonic Expression (MPE) support. Through a custom MaxForLive
                application called the Bridge, it connects conventional MIDI protocols with 53-TET chord construction,
                ensuring compatibility with modern digital audio workstations like Ableton Live (11/12). The system
                features interactive chord manipulation tools, a comprehensive Scale Editor, and implements modal
                interchange techniques, allowing musicians to discover new harmonic possibilities while maintaining
                meaningful connections to established modal frameworks.</p>
        </section>

        <!-- Key Features -->
        <section class="project-section">
            <h2 class="text-2xl font-bold mb-4 text-blue-600">Key Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>Scale Editor</h3>
                    <p>Interactive visualization tool for editing interval distances and exploring different configurations in
                        53-TET, with comprehensive control over interval qualities from subminor to supermajor.</p>
                </div>
                <div class="feature-card">
                    <h3>Modal Interchange</h3>
                    <p>8x8 grid interface for exploring parallel and relative modal substitutions, allowing real-time
                        experimentation with chord progressions and harmonic trajectories in microtonality.</p>
                </div>
                <div class="feature-card">
                    <h3>Voicing Editor</h3>
                    <p>Spiral visualization interface for chord voicing control, featuring dynamic voice leading and intuitive
                        representation of note relationships across octaves based on Chew's method.</p>
                </div>
                <div class="feature-card">
                    <h3>MIDI Integration</h3>
                    <p>Custom MaxForLive Bridge application enabling precise microtonal control through MPE, maintaining
                        compatibility with Ableton Live</p>
                </div>
            </div>
        </section>

        <!-- Add the chord progression section here -->
        <section class="project-section">
            <div id="chord-progression-root"></div>
        </section>

        <!-- Download the app     -->
        <section class="project-section">
            <h2 class="text-2xl font-bold mb-4 text-blue-600">Download & Installation</h2>
            <p>Microtonal Explorer is currently available for macOS users.</p>

            <div class="feature-card">
                <h3>Download</h3>
                <!-- <p><a href="https://github.com/fifty-three-tet/microtonal_explorer_project/releases/download/v1.0.0/ChromaFlow_Interface_v1.0.0.zip" -->
                        <p><a href=""
                        class="download-button">Download Microtonal Explorer v1.0.0</a></p>
                <p class="version-info">Version 1.0.0 - macOS only</p>
            </div>

            <div class="feature-card">
                <h3>Installation Instructions for Mac</h3>
                <ol>
                    <li>Download the application file</li>
                    <li>Unzip the file if it's compressed</li>
                    <li><strong>Important:</strong> When you see the message "ChromaFlow_Interface_v1.0.0 is damaged and
                        can't be opened":
                        <ul>
                            <li>Open Terminal (find it in Applications > Utilities)</li>
                            <li>Copy and paste this command (replace PATH_TO_APP with the path to where your app is located):</li>
                            <li><code>xattr -cr ~/PATH_TO_APP/ChromaFlow_Interface_v1.0.0.app</code></li>
                        </ul>
                    </li>
                    <li>After running the Terminal command:
                        <ul>
                            <li>Right-click (or Control-click) on the app icon</li>
                            <li>Select "Open" from the context menu</li>
                            <li>Click "Open" in the security dialog</li>
                        </ul>
                    </li>
                </ol>
                <div class="feature-card">
                    <h3>Note</h3>
                    <p>These steps are necessary because the app isn't signed with an Apple Developer certificate. This
                        is a one-time process to tell macOS that you trust this application.</p>
                </div>
                <li>If prompted, allow any required permissions for:
                    <ul>
                        <li>MIDI access</li>
                        <li>Audio access</li>
                    </ul>
                </li>
                </ol>
            </div>

            <div class="feature-card">
                <h3>Why these steps?</h3>
                <p>Since the app isn't from the Mac App Store, macOS's security features will initially block it. Using
                    the right-click method tells macOS you trust this application. This is a standard security measure
                    for apps distributed outside the App Store.</p>
            </div>

            <style>
                .download-button {
                    display: inline-block;
                    background: var(--primary-color);
                    color: white;
                    padding: 12px 24px;
                    border-radius: 10px;
                    text-decoration: none;
                    margin: 10px 0;
                }

                .download-button:hover {
                    background: var(--secondary-color);
                }

                .version-info {
                    color: #666;
                    font-size: 0.9em;
                }

                ol li {
                    margin-bottom: 10px;
                }

                ul li {
                    margin: 5px 0;
                }
            </style>
        </section>

        <section class="project-section">
            <h2 class="text-2xl font-bold mb-4 text-blue-600">Documentation</h2>
            <p>The paper is available in this link</p>
            <ul>
                <li>If you use this work in your research, please cite it as follows:</li>
            </ul>
        </section>

        <section class="project-section">
            <h2 class="text-2xl font-bold mb-4 text-blue-600">License</h2>
            <p>This project is licensed under the GNU General Public License v3.0 - see the LICENSE file in the
                repository for details.</p>
        </section>
    </div>
    <!-- Add the React component script -->
    <script type="text/babel">
        // Add Modal Interchange Info Component
        const ModalInterchangeInfo = () => {
            return (
                <div className="mb-8 p-6 bg-gray-50 rounded-lg">
                    <h2 className="text-2xl font-bold mb-4 text-blue-600">Understanding Modal Interchange</h2>
                    <p className="mb-4">
                        Modal interchange expands harmonic possibilities by borrowing chords from parallel
                        or relative modes while maintaining connection to the original mode.
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="p-3 bg-white rounded shadow-sm">
                            <h3 className="font-bold text-blue-500 mb-2">Parallel Interchange</h3>
                            <p>This involves borrowing chords from a mode sharing the same root as the original one. For instance, if we are in C major/Ionian, we can borrow from C Aeolian.</p>
                        </div>
                        <div className="p-3 bg-white rounded shadow-sm">
                            <h3 className="font-bold text-blue-500 mb-2">Relative Interchange</h3>
                            <p>This involves shifting to a mode where the original root functions as a different degree of the scale and 
                                borrowing chords from the obtained mode. For instance, starting from C major/Ionian, an Aeolian relative modal interchange 
                                would place C at the 6th degree of E♭ major/Ionian. Therefore, we can borrow from E♭ major.</p>
                        </div>
                    </div>
                </div>
            );
        };
        // Chord Progression Grid Component
        const ChordProgressionGrid = () => {
            const [activeButtons, setActiveButtons] = React.useState(new Set());
            const [audioCache] = React.useState(new Map());
            const [loadingStatus, setLoadingStatus] = React.useState(new Map());

            const progressions = [
                // First set of progressions (Ionian-based)
                { chords: ['Cmaj7[I]', 'Am7[VI]', 'Fmaj7[IV]', 'Dm7[II]', 'Cmaj9[I]'], label: 'Original' },
                { chords: ['Cmaj7[I]', 'Aø7[VI]', 'F7[IV]', 'Dm7[II]', 'Cmaj9[I]'], label: 'P: Dorian' },
                { chords: ['Cmaj7[I]', 'vG#maj7[VI]', 'Fm7[IV]', 'vC#maj7[II]', 'Cmaj9[I]'], label: 'P: Phrygian' },
                { chords: ['Cmaj7[I]', 'vG#maj7[VI]', 'Fm7[IV]', 'Dø7[II]', 'Cmaj9[I]'], label: 'P: Aeolian' },
                { chords: ['Cmaj7[I]', 'Gm7[V]', 'vD#maj7[III]', 'Cm7[I]', 'Cmaj9[I]'], label: 'R: Dorian' },
                { chords: ['Cmaj7[I]', 'Fm7[IV]', 'vC#maj7[II]', 'Bbm7[VII]', 'Cmaj9[I]'], label: 'R: Phrygian' },
                { chords: ['Cmaj7[I]', 'Cm7[I]', 'vG#maj7[VI]', 'Fm7[IV]', 'Cmaj9[I]'], label: 'R: Aeolian' },
                { chords: ['Cmaj7[I]', 'Bbm7[VII]', 'vF#maj7[V]', 'vD#m7[III]', 'Cmaj9[I]'], label: 'R: Locrian' },

                // Divider
                { chords: ['', '', '', '', ''], label: '' },

                // Second set of progressions (original from code)
                { chords: ['CvMvm7[I]', 'FvMvM7[IV]', 'Dm7[II]', 'Gvm7[V]', 'CvMvm9[I]'], label: 'Original' },
                { chords: ['CvMvm7[I]', 'Fvm7[IV]', 'vDø^m7[II]', 'vG^m^m7[V]', 'CvMvm9[I]'], label: 'P: Dorian' },
                { chords: ['CvMvm7[I]', 'F^m^m7[IV]', 'C#vMvM7[II]', 'vF#^Mmaj7[V]', 'CvMvm9[I]'], label: 'P: Phrygian' },
                { chords: ['CvMvm7[I]', '^Fm7[IV]', 'vC#Mmaj7[II]', 'Gø^m7[V]', 'CvMvm9[I]'], label: 'P: Aeolian' },
                { chords: ['CvMvm7[I]', 'vD#vMvM7[III]', 'Cm7[I]', 'Fvm7[IV]', 'CvMvm9[I]'], label: 'R: Dorian' },
                { chords: ['CvMvm7[I]', 'C#vMvM7[II]', '^Bbm7[VII]', 'D#vm7[III]', 'CvMvm9[I]'], label: 'R: Phrygian' },
                { chords: ['CvMvm7[I]', 'G#vMvM7[VI]', '^Fm7[IV]', '^Bbvm7[VII]', 'CvMvm9[I]'], label: 'R: Aeolian' },
                { chords: ['CvMvm7[I]', '^GvMvM7[V]', '^Em7[III]', '^Avm7[VI]', 'CvMvm9[I]'], label: 'R: Locrian' }
            ];

            const encodeFileName = (name) => {
                if (name === '') return '';
                if (name.includes('ø')) {
                    return name
                        .replace(/ø/g, '%C3%B8')
                        .replace(/#/g, '%23')
                        .replace(/\^/g, '%5E')
                        .replace(/\[/g, '%5B')
                        .replace(/\]/g, '%5D');
                }
                return encodeURIComponent(name);
            };

            React.useEffect(() => {
                const uniqueChords = new Set(progressions.flatMap(row => row.chords.filter(chord => chord !== '')));
                uniqueChords.forEach(chord => {
                    const audio = new Audio(`https://fifty-three-tet.github.io/microtonal_explorer_project/audio/${encodeFileName(chord)}.wav`);

                    const handleCanPlay = () => {
                        setLoadingStatus(prev => new Map(prev).set(chord, true));
                    };

                    const handleError = (e) => {
                        setLoadingStatus(prev => new Map(prev).set(chord, false));
                    };

                    audio.addEventListener('canplaythrough', handleCanPlay);
                    audio.addEventListener('error', handleError);
                    audio.preload = 'auto';

                    audioCache.set(chord, audio);
                    setLoadingStatus(prev => new Map(prev).set(chord, 'loading'));

                    audio.handleCanPlay = handleCanPlay;
                    audio.handleError = handleError;
                });

                return () => {
                    audioCache.forEach((audio) => {
                        if (audio.handleCanPlay) {
                            audio.removeEventListener('canplaythrough', audio.handleCanPlay);
                        }
                        if (audio.handleError) {
                            audio.removeEventListener('error', audio.handleError);
                        }
                    });
                };
            }, []);

            const handleChordClick = async (chord, rowIndex, colIndex) => {
                if (chord === '') return;

                const buttonId = `${rowIndex}-${colIndex}`;
                const audio = audioCache.get(chord);

                if (activeButtons.has(buttonId)) {
                    if (audio) {
                        audio.pause();
                        audio.currentTime = 0;
                        setActiveButtons(prev => {
                            const next = new Set(prev);
                            next.delete(buttonId);
                            return next;
                        });
                    }
                    return;
                }

                if (!audio || !audio.duration) {
                    return;
                }

                try {
                    audio.currentTime = 0;

                    setActiveButtons(prev => {
                        const next = new Set(prev);
                        next.add(buttonId);
                        return next;
                    });

                    await audio.play();

                    const handleEnded = () => {
                        setActiveButtons(prev => {
                            const next = new Set(prev);
                            next.delete(buttonId);
                            return next;
                        });
                        audio.removeEventListener('ended', handleEnded);
                    };

                    audio.addEventListener('ended', handleEnded);

                    setTimeout(() => {
                        if (activeButtons.has(buttonId)) {
                            handleEnded();
                        }
                    }, Math.ceil(audio.duration * 1000) + 1000);

                } catch (error) {
                    setActiveButtons(prev => {
                        const next = new Set(prev);
                        next.delete(buttonId);
                        return next;
                    });
                }
            };

            return (
                <div className="p-6 bg-white rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-4 text-blue-600">Modal Interchange Examples</h2>
                    <div className="grid gap-1">
                        {progressions.map((row, rowIndex) => (
                            <div key={rowIndex} className={`flex gap-1 items-center ${row.label === '' ? 'h-8' : ''}`}>
                                {row.chords.map((chord, colIndex) => (
                                    <button
                                        key={`${rowIndex}-${colIndex}`}
                                        onClick={() => handleChordClick(chord, rowIndex, colIndex)}
                                        className={`p-2 rounded-xl flex-1 text-center transition-colors border border-blue-500 
                                                ${chord === ''
                                                ? 'border-none'
                                                : activeButtons.has(`${rowIndex}-${colIndex}`)
                                                    ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                    : loadingStatus.get(chord) === false
                                                        ? 'bg-red-100 text-red-600'
                                                        : 'bg-white hover:bg-gray-50'
                                            }`}
                                        disabled={chord === '' || loadingStatus.get(chord) !== true}
                                    >
                                        {chord}
                                    </button>
                                ))}
                                <div className="w-32 text-gray-600 font-medium">
                                    {row.label}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Mount the React component
        const root = ReactDOM.createRoot(document.getElementById('chord-progression-root'));
            root.render(
                <React.Fragment>
                    <ModalInterchangeInfo />
                    <ChordProgressionGrid />
                </React.Fragment>
            );
    </script>

</body>
</html>